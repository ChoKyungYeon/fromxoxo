{% load bootstrap4 %}


<form action="{% url 'letter_quizapp:verify' pk=target_quiz.pk %}"
      method="post">
    {% csrf_token %}{% bootstrap_form form %}
    {% if quizstep == quiz_len %}
    <input type="submit" class="btn-submit-fixed" value="편지 확인하기">
    {% else %}
    <input type="submit" class="btn-submit-fixed" value="다음 질문으로">
    {% endif %}
</form>
<div id="item-letter" class="item-letter">
    <span class="text-content-bold">답 {{ target_quiz.answer_count }} 글자</span>
    <span class="icon-right material-icons">arrow_right</span>
    <span class="text-count" id="total-count">현재 0 글자</span>
    {% if user == target_letter.sender or user == target_letter.receiver %}
    <span class="text-answer">* {{ target_quiz.answer }}</span>
    {% endif %}
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    function restrictInput(event) {
        var regex = /^[a-zA-Zㄱ-ㅎㅏ-ㅣ가-힣0-9]*$/;
        var key = String.fromCharCode(!event.charCode ? event.which : event.charCode);
        if (!regex.test(key)) {
            event.preventDefault();
            return false;
        }
    }

    // Function to count characters
    function countCharacters() {
        var text = document.getElementById('field-answer').value; // Get the value of the input
        var totalCount = (text.match(/[ㄱ-ㅎㅏ-ㅣ가-힣a-zA-Z0-9]/g) || []).length;

        // Update the counts on the page
        document.getElementById('total-count').textContent = '현재 ' + totalCount + '글자';
    }

    // Get the input element by ID
    var answerInput = document.getElementById('field-answer');

    // Add event listeners for the input and keypress events
    answerInput.addEventListener('input', countCharacters);
    answerInput.addEventListener('keypress', restrictInput);

    // Call countCharacters initially to update the counts based on the current input value
    countCharacters();
});
</script>
