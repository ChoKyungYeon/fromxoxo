{% load static %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
.frame-footer{
    background: var(--blackgray);
    width: 100%;
    bottom:0;
    position: fixed;
    left: 0;
    padding:1.7rem var(--padding-frame);
}
.frame-footer .container-footer{
    width: 100%;
    height: 100%;
    position: relative;
    display: flex;
    flex-direction: row;
    justify-content:center;
    align-items:center;
    background: transparent;
}
.frame-footer .text-title{
    color: var(--white);
    font-size: var(--fontsize-bold);
}

.frame-footer .btn-save{
    background: var(--black);
    display: flex;
    flex-direction: row;
    justify-content:center;
    align-items:center;
    color:var(--white);
    height: 7rem;
    width: 7rem;
    font-size:2.5rem;
    border-radius: 50%;
    font-weight:var(--fontweight-content);
    position: absolute;
    border:1.1rem solid var(--blackgray);
    right: 0rem;
    top:-3.6rem;
}
</style>
{% if not user.is_authenticated %}
    <a href="{% url 'accountapp:login' %}?letter_pk={{ target_letter.pk }}" class="frame-footer">
        <div class="container-footer">
            <span class="text-title">
               로그인 후 편지 저장!
            </span>
            <div class="btn-save material-icons">
                cloud_download
            </div>
        </div>
    </a>
{% else %}
    {% if user != target_letter.sender and user != target_letter.receiver %}
    <a id="tosave" href="{% url 'letterapp:save' %}?letter_pk={{ target_letter.pk }}" class="frame-footer">
        <div class="container-footer">
            <span class="text-title">
                편지를 저장해요!
            </span>
            <div class="btn-save material-icons">
                cloud_download
            </div>
        </div>
    </a>
    {% else %}
    <button id="btn-download" class="frame-footer">
        <div class="container-footer">
            <span class="text-title">
                편지 스크린샷
            </span>
            <div class="btn-save material-icons">
                photo_camera
            </div>
        </div>
    </button>
    {% endif %}
{% endif %}

<script>
document.getElementById('btn-download').addEventListener('click', function() {
    html2canvas(document.querySelector('#letter-detail')).then(canvas => {
        // Convert the canvas to a data URL
        let imageURL = canvas.toDataURL('image/png');

        // Create a temporary link to trigger the download
        let downloadLink = document.createElement('a');
        downloadLink.href = imageURL;
        downloadLink.download = '편지-이미지.png';

        // Append the link to the document and trigger the download
        document.body.appendChild(downloadLink);
        downloadLink.click();

        // Clean up
        document.body.removeChild(downloadLink);
    });
});
</script>